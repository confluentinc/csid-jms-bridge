#!/bin/bash
# Copyright 2020 Confluent, Inc.

#
# Use shellcheck to lint this file
#
SERVERPIDS=$(jcmd | grep 'io\.confluent\.amq\.JmsBridgeMain' | grep 'backup' | awk '{print $1}')

if [ -z "$SERVERPIDS" ]; then
  echo "No server(s) to stop"
  exit 1
fi

for PID in $SERVERPIDS; do
  kill -s TERM "$PID"
  TRIES=0
  while kill -0 "$PID" >/dev/null 2>&1; do
    TRIES=$((TRIES+1))
    if [[ $TRIES -ge 3 ]]; then
      kill -s KILL $PID
    fi
    sleep 5;
  done
done
sleep 1
exit 0