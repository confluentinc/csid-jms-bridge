<!--
  ~ Copyright 2020 Confluent Inc.
  -->

<configuration xmlns="urn:activemq">
  <core xmlns="urn:activemq:core">

    <address-settings>
      <!--default for catch all-->
      <address-setting match="#">
        <address-full-policy>BLOCK</address-full-policy>
        <dead-letter-address>DLQ</dead-letter-address>
        <expiry-address>ExpiryQueue</expiry-address>
        <max-size-bytes>10Mb</max-size-bytes>
        <message-counter-history-day-limit>10</message-counter-history-day-limit>
        <redelivery-delay>0</redelivery-delay>
      </address-setting>
    </address-settings>

    <bindings-directory>${jms-bridge.data.dir:./data}/bindings</bindings-directory>

    <journal-directory>${jms-bridge.data.dir:./data}/journal</journal-directory>

    <large-messages-directory>${jms-bridge.data.dir:./data}/large-messages</large-messages-directory>

    <paging-directory>${jms-bridge.data.dir:./data}/paging</paging-directory>

    <security-enabled>false</security-enabled>

    <ha-policy>
      <replication>
        <master/>
      </replication>
    </ha-policy>

    <!-- Connectors -->
    <connectors>
      <connector name="netty-connector">tcp://${activemq.remoting.default.host:localhost}:${activemq.remoting.default.port:61616}</connector>
    </connectors>

    <!-- Acceptors -->
    <acceptors>
      <acceptor name="netty-acceptor">tcp://${activemq.remoting.default.host:localhost}:${activemq.remoting.default.port:61616}</acceptor>
    </acceptors>

    <broadcast-groups>
      <broadcast-group name="bg-group1">
        <group-address>${udp-address:231.7.7.7}</group-address>
        <group-port>9876</group-port>
        <broadcast-period>1000</broadcast-period>
        <connector-ref>netty-connector</connector-ref>
      </broadcast-group>
    </broadcast-groups>

    <discovery-groups>
      <discovery-group name="dg-group1">
        <group-address>${udp-address:231.7.7.7}</group-address>
        <group-port>9876</group-port>
        <refresh-timeout>60000</refresh-timeout>
      </discovery-group>
    </discovery-groups>

    <cluster-connections>
      <cluster-connection name="my-cluster">
        <connector-ref>netty-connector</connector-ref>
        <discovery-group-ref discovery-group-name="dg-group1"/>
      </cluster-connection>
    </cluster-connections>

  </core>
  <jms xmlns="urn:activemq:jms">
    <queue name="DLQ"/>
    <queue name="ExpiryQueue"/>
  </jms>
</configuration>