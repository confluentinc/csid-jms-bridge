<!--
  ~ Copyright 2020 Confluent Inc.
  -->

<configuration xmlns="urn:activemq">
  <core xmlns="urn:activemq:core">
    <acceptors>
      <!-- Default ActiveMQ Artemis Acceptor.  Multi-protocol adapter.  Currently supports Core, OpenWire, Stomp and AMQP. -->
      <acceptor name="activemq">
        tcp://${activemq.remoting.default.host:localhost}:${activemq.remoting.default.port:61616}
      </acceptor>
    </acceptors>

    <address-settings>
      <!--default for catch all-->
      <address-setting match="#">
        <address-full-policy>BLOCK</address-full-policy>
        <dead-letter-address>DLQ</dead-letter-address>
        <expiry-address>ExpiryQueue</expiry-address>
        <max-size-bytes>10Mb</max-size-bytes>
        <message-counter-history-day-limit>10</message-counter-history-day-limit>
        <redelivery-delay>0</redelivery-delay>
      </address-setting>
    </address-settings>

    <bindings-directory>${jms-bridge.data.dir:./data}/bindings</bindings-directory>

    <connectors>
      <!-- Default Connector.  Returned to clients during broadcast and distributed around cluster.  See broadcast and discovery-groups -->
      <connector name="activemq">
        tcp://${activemq.remoting.default.host:localhost}:${activemq.remoting.default.port:61616}
      </connector>
      <!-- Statially defines server for cluster connection. Additional connector-ref nodes must be added to cluster-connection for additional slave nodes. -->
      <!--<connector name="server1-connector">tcp://hostname:61616</connector>-->
    </connectors>
    <!-- To define a
    <cluster-connection name="my-cluster">
       <address/>
       <connector-ref>netty-connector</connector-ref>
       <retry-interval>500</retry-interval>
       <use-duplicate-detection>true</use-duplicate-detection>
       <message-load-balancing>STRICT</message-load-balancing>
       <max-hops>1</max-hops>
       <static-connectors allow-direct-connections-only="true">
          <connector-ref>server1-connector</connector-ref>
       </static-connectors>
    </cluster-connection>
    -->

    <!-- To Enable HA, an HA policy must be set, along with the servers designation. The Example configuration prodiced, statically sets the node as either a master or a slave. -->
    <!-- Master node configuration
    <ha-policy>
      <shared-store>
        <master>
          <failover-on-shutdown>true</failover-on-shutdown>
        </master>
      </shared-store>
    </ha-policy>
    -->

    <!-- Slave node configuration
    <ha-policy>
      <shared-store>
        <slave>
          <allow-failback>true</allow-failback>
        </slave>
      </shared-store>
    </ha-policy>
    -->
    <journal-directory>${jms-bridge.data.dir:./data}/journal</journal-directory>

    <journal-min-files>2</journal-min-files>

    <large-messages-directory>${jms-bridge.data.dir:./data}/large-messages</large-messages-directory>

    <paging-directory>${jms-bridge.data.dir:./data}/paging</paging-directory>

    <security-enabled>false</security-enabled>

  </core>
  <jms xmlns="urn:activemq:jms">
    <queue name="DLQ"/>
    <queue name="ExpiryQueue"/>
  </jms>
</configuration>